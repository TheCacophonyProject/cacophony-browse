language: node_js
node_js:
  - "lts/*"

env:
  - IS_CI_ENV=true

script:
- npm run lint

# Update files which need the right version number, build the packed
# release, install the nfpm tool and build the release deb package.
before_deploy:
- version=${TRAVIS_TAG/v/}
- npm version --no-git-tag-version ${version}
- npm run release
- "curl -sL https://github.com/goreleaser/nfpm/releases/download/v0.9.5/nfpm_0.9.5_Linux_x86_64.tar.gz | tar -C /tmp -xzf -"
- /tmp/nfpm pkg -t cacophony-browse_${version}.deb

deploy:
  provider: releases
  api_key:
    secure: "Wrrc9k+3P7gmogu6AFWxA0HdUFYlfrPObqwBKlKi/2Wi7Ntd3Y3UcaRXMacmcky9Dg7KzNejNNAW6gZTx7z/PJupqtiV2LEl07cBFpfXMp8CgMDNA77T+Cq4wINO9Z1N/fzFUbO/kVTs38UsWlZo0L7NFsr6vBus18OvbV6T/L12ORFe9dRcNZx7bR6pbgeeBFk+BKD2U32/dWQ75VYnBzAX8VkymWabayV1NoGPsEtdv61UQC6AOjXWvqzVvDo2OtIwyTNgun1Be74a4D6XU4PkGygdfepKEa64RoHQbBjMKHebMETmXR7ZSUyC2inUXyM4FP5cut/8tlGgkrEBJo77sVxmDciHYutM9ZjU9+057uMW4axVqkztqvPboyc+0kIyC3/UA1H0Ddyrqrc/38AnTIV/sApxr8oJFzNL8JoJWBUy394moQgMEF1fVlvvoim0S7xRTc0nyWQFZDl1NlEQtZIkeh0m5Hr7etTLFZh5pmO/9AF3rbWY3F1jTWUCci6cNR/c/HpoZQMlEhJQYH6D/Ev0cSp2TVjvBTfsXD2YeLMjyU6CsRerwBCVaokL0BE+w90u8U/OWe7aZsqMEtGt+vo6PkSQmc7MPB88tovMQfRMTSFPJ9gi8MQ8Bo2MJvPVHmRsAvJH2erqqcRUD8v5zsAVY25SY7r1bfmwwNw="
  skip_cleanup: true
  file_glob: true
  file: "*.deb"
  on:
    tags: true
    repo: TheCacophonyProject/cacophony-browse
